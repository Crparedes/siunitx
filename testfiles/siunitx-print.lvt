\input{regression-test}

\documentclass{article}

\usepackage{siunitx}

\begin{document}

\START

\ExplSyntaxOn

\OMIT
\cs_set_protected:Npn \test:nn #1#2
  {
    \hbox_set:Nn \l_tmpa_box { \siunitx_print:nn {#1} {#2} }
    \box_show:N \l_tmpa_box
    \hbox_set:Nn \l_tmpa_box { $ \siunitx_print:nn {#1} {#2} $ }
    \box_show:N \l_tmpa_box
    \group_begin:
      \keys_set:nn { siunitx } { mode = text }
      \hbox_set:Nn \l_tmpa_box { \siunitx_print:nn {#1} {#2} }
      \box_show:N \l_tmpa_box
      \hbox_set:Nn \l_tmpa_box { $ \siunitx_print:nn {#1} {#2} $ }
      \box_show:N \l_tmpa_box
    \group_end:
  }
\TIMO

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST { Printing~numbers }
  {
    \test:nn { number } { 123\,456 }
  }

\TEST { Printing~units }
  {
    \test:nn { unit } { \mathrm {J}\,\mathrm {mol}^{-1}\,\mathrm {K}^{-1} }
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST { Option~setting~"color" }
  {
    \group_begin:
      \keys_set:nn { siunitx } { color = red }
      \test:nn { unit } { \mathrm{kg} }
      \keys_set:nn { siunitx } { color =  }
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
    \group_begin:
      \keys_set:nn { siunitx } { number-color = red }
      \test:nn { number } { 123 }
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
    \group_begin:
      \keys_set:nn { siunitx } { unit-color = red }
      \test:nn { number } { 123 }
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
  }

\TEST { Option~setting~"mode" }
  {
    \group_begin:
      \test:nn { unit } { \mathrm{kg} }
      \keys_set:nn { siunitx } { mode = math }
      \test:nn { unit } { \mathrm{kg} }
      \keys_set:nn { siunitx } { mode = text }
      \test:nn { unit } { \mathrm{kg} }
      \keys_set:nn { siunitx } { mode = match }
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
    \group_begin:
      \keys_set:nn { siunitx } { number-mode = math }
      \test:nn { number } { 123 }
      \test:nn { unit } { \mathrm{kg} }
      \keys_set:nn { siunitx } { number-mode = text }
      \test:nn { number } { 123 }
      \test:nn { unit } { \mathrm{kg} }
      \keys_set:nn { siunitx } { number-mode = match }
      \test:nn { number } { 123 }
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
    \group_begin:
      \keys_set:nn { siunitx } { unit-mode = math }
      \test:nn { number } { 123 }
      \test:nn { unit } { \mathrm{kg} }
      \keys_set:nn { siunitx } { unit-mode = text }
      \test:nn { number } { 123 }
      \test:nn { unit } { \mathrm{kg} }
      \keys_set:nn { siunitx } { unit-mode = match }
      \test:nn { number } { 123 }
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
  }

\TEST { Option~setting~"propagate-math-font" }
  {
    \hbox_set:Nn \l_tmpa_box
      { $ \mathsf { \siunitx_print:nn { unit } { \mathrm{kg} } } $ }
    \box_show:N \l_tmpa_box
    \hbox_set:Nn \l_tmpa_box
      { $ \mathtt { \siunitx_print:nn { unit } { \mathrm{kg} } } $ }
    \box_show:N \l_tmpa_box
    \keys_set:nn { siunitx } { propagate-math-font = true } 
    \hbox_set:Nn \l_tmpa_box
      { $ \mathsf { \siunitx_print:nn { unit } { \mathrm{kg} } } $ }
    \box_show:N \l_tmpa_box
    \hbox_set:Nn \l_tmpa_box
      { $ \mathtt { \siunitx_print:nn { unit } { \mathrm{kg} } } $ }
    \box_show:N \l_tmpa_box
  }

\TEST { Option~setting~"reset-math-version" }
  {
    \group_begin:
      \boldmath
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
    \keys_set:nn { siunitx } { reset-math-version = false }
    \group_begin:
      \boldmath
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
  }

\TEST { Option~setting~"reset-text-family" }
  {
    \group_begin:
      \sffamily
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
    \keys_set:nn { siunitx } { reset-text-family = false }
    \group_begin:
      \sffamily
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
  }

\TEST { Option~setting~"reset-text-series" }
  {
    \group_begin:
      \bfseries
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
    \keys_set:nn { siunitx } { reset-text-series = false }
    \group_begin:
      \bfseries
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
  }

\TEST { Option~setting~"reset-text-shape" }
  {
    \group_begin:
      \itshape
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
    \keys_set:nn { siunitx } { reset-text-shape = false }
    \group_begin:
      \itshape
      \test:nn { unit } { \mathrm{kg} }
    \group_end:
  }

\end{document}
