\input{regression-test}

\RequirePackage[enable-debug,check-declarations]{expl3}

\ExplSyntaxOn
\debug_on:n { deprecation }
\ExplSyntaxOff

\RequirePackage{siunitx}

\documentclass{article}

\ExplSyntaxOn
\OMIT
\cs_set_protected:Npn \testunit #1
  {
    \hbox_set:Nn \l_tmpa_box { \unit {#1} }
    \box_show:N \l_tmpa_box
    \hbox_set:Nn \l_tmpa_box { $ \unit {#1} $ }
    \box_show:N \l_tmpa_box
    \group_begin:
      \keys_set:nn { siunitx } { mode = text }
      \hbox_set:Nn \l_tmpa_box { \unit {#1} }
      \box_show:N \l_tmpa_box
      \hbox_set:Nn \l_tmpa_box { $ \unit {#1} $ }
      \box_show:N \l_tmpa_box
    \group_end:
  }
\TIMO
\ExplSyntaxOff

\begin{document}

\START

\TEST { Typesetting~angstrom }
  {
    \testunit { \angstrom } 
  }

\TEST { Typesetting~ohm }
  {
    \testunit { \ohm } 
  }

\TEST { Typesetting~micro }
  {
    \testunit { \micro \metre } 
  }

\end{document}
